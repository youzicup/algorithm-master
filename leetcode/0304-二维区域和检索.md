# 304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢
[åŸé¢˜é“¾æ¥ğŸ”—](https://leetcode-cn.com/problems/range-sum-query-2d-immutable/)  

ç»™å®šä¸€ä¸ªäºŒç»´çŸ©é˜µ `matrix` ï¼Œä»¥ä¸‹ç±»å‹çš„å¤šä¸ªè¯·æ±‚ï¼š

è®¡ç®—å…¶å­çŸ©å½¢èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼Œè¯¥å­çŸ©é˜µçš„å·¦ä¸Šè§’ä¸º `(row1, col1)` ï¼Œå³ä¸‹è§’ä¸º `(row2, col2)` ã€‚
å®ç° `NumMatrix` ç±»ï¼š

 - `NumMatrix(int[][] matrix)` ç»™å®šæ•´æ•°çŸ©é˜µ `matrix` è¿›è¡Œåˆå§‹åŒ–
 - `int sumRegion(int row1, int col1, int row2, int col2)` è¿”å› **å·¦ä¸Šè§’** `(row1, col1)` ã€**å³ä¸‹è§’** `(row2, col2)` æ‰€æè¿°çš„å­çŸ©é˜µçš„å…ƒç´  **æ€»å’Œ** ã€‚

## è§£é¢˜æ€è·¯
### å‰ç¼€æ³•
åœ¨åˆå§‹åŒ–è¯¥ç»“æ„çš„æ—¶å€™ç›´æ¥è¿›è¡Œä¸€æ¬¡éå†ï¼Œå¾—åˆ°æ¯ä¸€ä½å¯¹åº”çš„åŒºåŸŸå…ƒç´ å’Œï¼Œå³

$$ sum_{(i,j)} = nums_{(0,0)} + nums_{(0,1)} + ... + nums_{(1,0)} + ... + nums_{(i, j)} $$

å†åœ¨åœ¨é¦–è¡Œå’Œé¦–åˆ—æ’å…¥ä¸€è¡Œé›¶å€¼ï¼Œå³

$$ sum_{(i,j)} = nums_{(0,0)} + nums_{(0,1)} + ... + nums_{(1,0)} + ... + nums_{(i - 1, j - 1)} $$

éšååœ¨ `sumRange` å‡½æ•°ä¸­è¿›è¡Œè¿ç®—ï¼š

$$ res = sum_{(row_2 + 1, col_2 + 1)} + sum_{(row_1, col_1)} - sum_{(row_2 + 1, col_1)} - sum_{(row_1, col_2 + 1)} $$

å³å¯å¾—åˆ°ä¸€ä¸ªåŒºåŸŸç»“æœï¼Œ `sumRange` å‡½æ•°å¤æ‚åº¦é™ä½ä¸º $ O(1) $ã€‚

åŠ å…¥é›¶å€¼æ˜¯ä¸ºäº†å¤„ç†è¾¹ç•Œæƒ…å†µï¼Œå¯å‚è§ [303. åŒºåŸŸå’Œæ£€ç´¢](./0303-åŒºåŸŸå’Œæ£€ç´¢.md)ã€‚`res` åˆ’åˆ†åŒºåŸŸå¦‚ä¸‹å›¾ã€‚

![åŒºåŸŸåˆ’åˆ†ç¤ºæ„å›¾](./pic/0304-01.åŒºåŸŸç¤ºæ„å›¾.png)

## ä»£ç å®ç°

**JavaScriptï¼š**
```js
/**
 * @param {number[][]} matrix
 */
var NumMatrix = function(matrix) {
  let right = matrix[0].length, down = matrix.length
  this.sum = []
  for(let i = 0; i <= down; i++) {
    this.sum.push(new Array())
    for(let j = 0; j <= right; j++) {
      if(i === 0 || j === 0) {
        this.sum[i].push(0)
      } else {
        this.sum[i].push(matrix[i - 1][j - 1] + this.sum[i - 1][j] + this.sum[i][j - 1] - this.sum[i - 1][j - 1])
      }
    }
  }
};

/** 
 * @param {number} row1 
 * @param {number} col1 
 * @param {number} row2 
 * @param {number} col2
 * @return {number}
 */
NumMatrix.prototype.sumRegion = function(row1, col1, row2, col2) {
  return this.sum[row1][col1] + this.sum[row2 + 1][col2 + 1] - this.sum[row1][col2 + 1] - this.sum[row2 + 1][col1]
};

/**
 * Your NumMatrix object will be instantiated and called as such:
 * var obj = new NumMatrix(matrix)
 * var param_1 = obj.sumRegion(row1,col1,row2,col2)
 */
```

**Go:**
```go
type NumMatrix struct {
    sum [][]int
}

func Constructor(matrix [][]int) NumMatrix {
    sum := make([][]int, len(matrix) + 1)
    sum[0] = make([]int, len(matrix[0]) + 1)
    for i, row := range matrix {
        sum[i + 1] = make([]int, len(matrix[0]) + 1)
        for j, item := range row {
            sum[i + 1][j + 1] = item + sum[i][j + 1] + sum[i + 1][j] - sum[i][j]
        }
    }
    return NumMatrix{sum}
}

func (this *NumMatrix) SumRegion(row1 int, col1 int, row2 int, col2 int) int {
    return this.sum[row2 + 1][col2 + 1] + this.sum[row1][col1] - this.sum[row2 + 1][col1] - this.sum[row1][col2 + 1]
}

/**
 * Your NumMatrix object will be instantiated and called as such:
 * obj := Constructor(matrix);
 * param_1 := obj.SumRegion(row1,col1,row2,col2);
 */
```
